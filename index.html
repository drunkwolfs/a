<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <meta name="format-detection" content="telephone=no"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="MobileOptimized" content="176"/>
    <meta name="HandheldFriendly" content="True"/>
    <meta name="robots" content="noindex,nofollow"/>
    <title></title>
    <link rel="stylesheet" href="home.css">
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script type="text/javascript" src="https://telegram.org/js/telegram-web-app.js?1"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min.js"></script>
    <script type="text/javascript" src="common.js"></script>
    <script>
      // Устанавливает стиль для светлой\темной темы
      function setThemeClass() {
        document.documentElement.className = Telegram.WebApp.colorScheme;
      }
      Telegram.WebApp.onEvent('themeChanged', setThemeClass);
      setThemeClass();

      //Подгрузка базы данных
      function getDecompressedJsonParam(paramName) {
          const urlParams = new URLSearchParams(window.location.search);
          const encodedParam = urlParams.get(paramName);
          if (!encodedParam) {
              console.log(`No parameter found for ${paramName}`);
              return null;
          }
          try {
              const base64Decoded = atob(encodedParam);
              const charList = base64Decoded.split('').map(c => c.charCodeAt(0));
              const byteArray = new Uint8Array(charList);
              const decompressed = pako.inflate(byteArray, { to: 'string' });
              const json = JSON.parse(decompressed);
              return json;
          } catch (e) {
              console.error(`Error processing parameter ${paramName}:`, e);
              return null;
          }
      }
      function modifItems(itemsArray){
        for (let i = 0; i < itemsArray.length; i++) {
          itemsArray[i].push(true);
        }
        return itemsArray;
      }

      const users = getDecompressedJsonParam('users');
      const items = modifItems(getDecompressedJsonParam('items'));

    </script>
  </head>

  <body>
    <table class="main-table">
      <tr>
        <td colspan="2">
          <div id="content"><!-- Страницы --></div>
        </td>
      </tr>
      <tr>
        <td><button id="prev">Закрыть</button></td>
        <td><button id="next">Далее</button></td>
      </tr>
    </table>
    <script>
      //Навигация
      var pages = ['item_page.html', 'user_page.html'];
      var currentPage = 0;
      // Функция для загрузки контента
      function loadContent(page) {
          fetch(pages[page])
              .then(response => response.text())
              .then(html => {
                  document.getElementById('content').innerHTML = html;
              })
              .catch(error => {
                  console.error('Ошибка при загрузке страницы:', error);
                  document.getElementById('content').innerHTML = '<p>Ошибка загрузки страницы.</p>';
              });
              const scripts = document.getElementById('content').querySelectorAll('script');
                  for (const script of scripts) {
                    eval(script.textContent);
                  }
      }
      // Загружаем начальный контент
      loadContent(currentPage);
      document.getElementById('prev').addEventListener('click', () => {
          if (currentPage > 0) {
              currentPage--;
              loadContent(currentPage);
          }
      });
      document.getElementById('next').addEventListener('click', () => {
          currentPage++;
          loadContent(currentPage);
      });</script>
  </body>

</html>